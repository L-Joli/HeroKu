<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">

</head>
<body>

<style type='text/css'>
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #005290;
        font-family: "Arial", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #005290;
    }

    .embeddedServiceLiveAgentStateChatPlaintextMessageDefaultUI.plaintextContent{
        margin-left: 0px !important;
    }
    .content{
        display: none !important;
    }
    .avatar{
        display: none !important;
    }
    .avatar{
        display: none !important;
    }

    .embeddedServiceLiveAgentQueuePosition.queuePositionWaiting .youAreNextMessage {
        font-size: 20px !important;
    }
</style>

<script type='text/javascript' >
    var initESW = function(gslbBaseURL) {
        embedded_svc.settings.buttonId = settings.buttonId;
        embedded_svc.settings.displayHelpButton = false;
        embedded_svc.settings.language = settings.language;
        embedded_svc.settings.enabledFeatures = ['LiveAgent'];
        embedded_svc.settings.entryFeature = 'LiveAgent';
        embedded_svc.settings.extraPrechatFormDetails = settings.extraPrechatFormDetails;
        embedded_svc.settings.extraPrechatInfo = [{
            "entityFieldMaps": [{
              "doCreate":false,
              "doFind":true,
              "fieldName":"Member_Number__c",
              "isExactMatch":true,
              "label":"Member Number"
            }],
            "entityName":"Account",
            "saveToTranscript": "AccountId",
          }];

        embedded_svc.addEventHandler("featureLoaded",
        function() {
            embedded_svc.onHelpButtonClick();
        }); 
                
        embedded_svc.addEventHandler("onChatEstablished", function(data) {
            console.log("onChatEstablished event was fired.  liveAgentSessionKey was " + data.liveAgentSessionKey);
            //need to be set
            //call salesforce api to get the survey url
            //Methodï¼š get, URI:/livechatsurvey/{data.liveAgentSessionKey}
        });


        embedded_svc.addEventHandler("onChatEndedByChasitor", function(data) {
            console.log("onChatEndedByChasitor event was fired.  liveAgentSessionKey was " + data.liveAgentSessionKey);
            //need to be set
            //replace the  survey url that generated in onChatEstablished event callback function
            window.open("https://dev1-member-portal.cs114.force.com/memberportal/survey/runtimeApp.app?invitationId=0Ki1y00000004IG&surveyName=chat_feedback&UUID=037fd4a2-befe-4205-a2be-cad6bf807572", "_blank");
        });


        embedded_svc.init(
            settings.myDomainURL,
            settings.communityURL,
            gslbBaseURL,
            settings.orgId,
            'Live_Chat_Lux_SC',
            {
                baseLiveAgentContentURL: settings.baseLiveAgentContentURL,
                deploymentId: settings.deploymentId,
                buttonId: settings.buttonId,
                baseLiveAgentURL: settings.baseLiveAgentURL,
                eswLiveAgentDevName: settings.eswLiveAgentDevName,
                isOfflineSupportEnabled: false
            }
        );

     

    };



    function routeButton(){
        if(settings.buttonType == "Luxury Reserve"){
            switch (settings.language) {
            case "zh_CN":
                settings.buttonId = "5731y0000008OPB";//hardcode
                break;
            case "zh_HK":
                settings.buttonId = "5731y0000008OP6";//hardcode
                break;
            default:
                settings.buttonId = "5731y0000008ONy";//hardcode
            }
        }else{
            switch (settings.language) {
            case "zh_CN":
                settings.buttonId = "5731y0000008OP1";//hardcode
                break;
            case "zh_HK":
                settings.buttonId = "5731y0000008OOw";//hardcode
                break;
            default:
                settings.buttonId = "5731y0000008OO3";//hardcode
            }
        }

        //embedded_svc.settings.directToButtonRouting = function() {
        //        return settings.buttonId;
        //}

    }


    function checkAgentAvailable(){
        var agentAvailable = true;
        //need to do: call live agent API to check agent status with buttonId, need do the proxy by member protal
        if(agentAvailable){
            StartChat();
        }else{
        //need to do: no agent online then redirect to offline contact us page
        }

    }


    var StartChat = function() {
        settings = {
                    buttonType:"", //ne be set by routeButton() function
                    language:"zh_CN",//need to be set
                    channel:"Member Portal", //need to be set
                    membernumber:"AADEV-0000009230", //need to be set
                    orgId:"00D1y0000008l0f", //hardcode
                    deploymentId:"5721y0000008OMb", //hardcode
                    myDomainURL:"https://hkairportloyalty--dev1.my.salesforce.com", //hardcode
                    communityURL:"https://dev1-member-portal.cs114.force.com/memberportal", //hardcode
                    eswJSURL:"https://hkairportloyalty--dev1.my.salesforce.com/embeddedservice/5.0/esw.min.js", //hardcode
                    gslbBaseURL:"https://service.force.com", //hardcode
                    baseLiveAgentURL:"https://d.la2-c1cs-hnd.salesforceliveagent.com/chat", //hardcode
                    baseLiveAgentContentURL:"https://c.la2-c1cs-hnd.salesforceliveagent.com/content", //hardcode
                    eswLiveAgentDevName:"EmbeddedServiceLiveAgent_Parent04I1y0000004CD5EAM_172e067c590", //hardcode
                    extraPrechatFormDetails:[]
                    }

        var e = window.event;                
        if(e.target.innerText == 'Lux'){ //need to be set to check which button clicked
            settings.buttonType = 'Luxury Reserve';//hardcode
        }else{
            settings.buttonType = 'General Enquiry'//hardcode
        }


        settings.extraPrechatFormDetails = [{"label": "Member Number","value": settings.membernumber,"displayToAgent": true},
                             {"label": "language","value": settings.language ,"displayToAgent": true},
                             {"label": "Chat Type","value": settings.buttonType,"displayToAgent": true, "transcriptFields": ["Type__c"],},
                             {"label": "Chat Channel","value": settings.channel,"displayToAgent": true, "transcriptFields": ["Channel__c"],}];         

        if (!window.embedded_svc) {
            var s = document.createElement('script');
            s.setAttribute('src', settings.eswJSURL);
            s.setAttribute('sandbox', 'allow-top-navigation allow-same-origin allow-forms allow-scripts');
            s.onload = function() {
                routeButton();
                initESW(null);
                
        };
        document.body.appendChild(s);
        } else {
            routeButton();
            embedded_svc.onHelpButtonClick();
        }
    }

</script>

<button type="button" onclick="checkAgentAvailable()">Lux</button>
<button type="button" onclick="checkAgentAvailable()">Gen</button>


    
</body>
</html>
